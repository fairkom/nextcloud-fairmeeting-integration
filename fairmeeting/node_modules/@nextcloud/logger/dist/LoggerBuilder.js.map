{"version":3,"file":"LoggerBuilder.js","names":["LoggerBuilder","factory","context","level","OC","config","loglevel","undefined","LogLevel","Warn","debug","Debug","appId","app","uid","user","getCurrentUser"],"sources":["../lib/LoggerBuilder.ts"],"sourcesContent":["/// <reference types=\"@nextcloud/typings\" />\n\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { ILogger, ILoggerFactory, LogLevel } from './contracts'\n\ndeclare var OC: Nextcloud.v22.OC | Nextcloud.v23.OC | Nextcloud.v24.OC;\n\nexport class LoggerBuilder {\n\n    private context: any\n\n    private factory: ILoggerFactory\n\n    constructor(factory: ILoggerFactory) {\n        this.context = {}\n        this.factory = factory\n        // Up to, including, nextcloud 24 the loglevel was not exposed\n        this.context.level = OC?.config?.loglevel !== undefined ? OC.config.loglevel : LogLevel.Warn\n        // Override loglevel if we are in debug mode\n        if (OC?.debug) {\n            this.context.level = LogLevel.Debug\n        }\n    }\n\n    setApp(appId: string): LoggerBuilder {\n        this.context.app = appId\n        return this\n    }\n\n    setLogLevel(level: LogLevel) {\n        this.context.level = level\n        return this\n    }\n\n    setUid(uid: string): LoggerBuilder {\n        this.context.uid = uid\n        return this\n    }\n\n    detectUser(): LoggerBuilder {\n        const user = getCurrentUser()\n        if (user !== null) {\n            this.context.uid = user.uid\n        }\n\n        return this\n    }\n\n    build(): ILogger {\n        return this.factory(this.context)\n    }\n\n}\n"],"mappings":";;;;;;;;;AAEA;;AACA;;;;;;;;;;IAIaA,a;EAMT,uBAAYC,OAAZ,EAAqC;IAAA;;IAAA;;IAAA;;IAAA;;IACjC,KAAKC,OAAL,GAAe,EAAf;IACA,KAAKD,OAAL,GAAeA,OAAf,CAFiC,CAGjC;;IACA,KAAKC,OAAL,CAAaC,KAAb,GAAqB,QAAAC,EAAE,UAAF,gDAAIC,MAAJ,0DAAYC,QAAZ,MAAyBC,SAAzB,GAAqCH,EAAE,CAACC,MAAH,CAAUC,QAA/C,GAA0DE,mBAAA,CAASC,IAAxF,CAJiC,CAKjC;;IACA,YAAIL,EAAJ,iCAAI,KAAIM,KAAR,EAAe;MACX,KAAKR,OAAL,CAAaC,KAAb,GAAqBK,mBAAA,CAASG,KAA9B;IACH;EACJ;;;;WAED,gBAAOC,KAAP,EAAqC;MACjC,KAAKV,OAAL,CAAaW,GAAb,GAAmBD,KAAnB;MACA,OAAO,IAAP;IACH;;;WAED,qBAAYT,KAAZ,EAA6B;MACzB,KAAKD,OAAL,CAAaC,KAAb,GAAqBA,KAArB;MACA,OAAO,IAAP;IACH;;;WAED,gBAAOW,GAAP,EAAmC;MAC/B,KAAKZ,OAAL,CAAaY,GAAb,GAAmBA,GAAnB;MACA,OAAO,IAAP;IACH;;;WAED,sBAA4B;MACxB,IAAMC,IAAI,GAAG,IAAAC,oBAAA,GAAb;;MACA,IAAID,IAAI,KAAK,IAAb,EAAmB;QACf,KAAKb,OAAL,CAAaY,GAAb,GAAmBC,IAAI,CAACD,GAAxB;MACH;;MAED,OAAO,IAAP;IACH;;;WAED,iBAAiB;MACb,OAAO,KAAKb,OAAL,CAAa,KAAKC,OAAlB,CAAP;IACH"}